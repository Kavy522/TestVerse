<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Exam Results & Grading - University Exam Portal">
  <title>Results & Grading - University Exam Portal</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../css/styles.css">
  
  <link rel="stylesheet" href="../../css/pages/staff/results.css">
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-content">
        <a href="../../index.html" class="navbar-brand">
          <div class="navbar-logo">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
              <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
            </svg>
          </div>
          Exam Portal
        </a>
        <div class="navbar-menu">
          <a href="dashboard.html" class="navbar-link">Dashboard</a>
          <a href="exams.html" class="navbar-link">Exams</a>
          <a href="students.html" class="navbar-link">Students</a>
          <a href="results.html" class="navbar-link active">Results</a>
        </div>
        <div class="navbar-user">
          <span class="badge badge-primary">Staff</span>
          <button class="btn btn-ghost btn-sm" onclick="Auth.logout()">Logout</button>
        </div>
      </div>
    </div>
  </nav>
  
  <main class="main-content">
    <div class="container">
      <div class="page-header animate-fadeInUp">
        <div>
          <h1 class="text-3xl font-bold" id="page-title">Results & Grading</h1>
          <p class="text-muted" id="exam-subtitle">Select an exam to grade & publish results</p>
        </div>
        <div class="flex gap-3">
          <select class="form-input form-select" id="exam-select" style="min-width: 250px;">
            <option value="">Select an exam</option>
          </select>
        </div>
      </div>
      
      <!-- Action Buttons Bar -->
      <div class="action-bar" id="action-bar" style="display: none;">
        <div class="action-bar-left">
          <button class="btn btn-primary" id="generate-btn" onclick="autoGradeMCQs()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
            </svg>
            Auto-Grade MCQs
          </button>
        </div>
        <div class="action-bar-right">
          <div class="grading-summary" id="grading-summary"></div>
          <button class="btn btn-success" id="publish-all-btn" onclick="bulkPublish('publish')" disabled>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
              <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            Publish All Results
          </button>
          <button class="btn btn-warning" id="unpublish-all-btn" onclick="bulkPublish('unpublish')" style="display: none;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
              <line x1="1" y1="1" x2="23" y2="23"/>
            </svg>
            Unpublish All
          </button>
        </div>
      </div>
      
      <!-- Analytics -->
      <div class="analytics-card mb-8" id="analytics-section" style="display: none;">
        <h3 class="text-lg font-semibold mb-6">Grading Overview</h3>
        <div class="analytics-grid" id="analytics-grid">
          <div class="analytics-item">
            <div class="analytics-value text-primary" id="total-attempts">-</div>
            <div class="analytics-label">Total Submissions</div>
          </div>
          <div class="analytics-item">
            <div class="analytics-value text-warning" id="needs-grading">-</div>
            <div class="analytics-label">Need Grading</div>
          </div>
          <div class="analytics-item">
            <div class="analytics-value text-success" id="fully-graded">-</div>
            <div class="analytics-label">Fully Graded</div>
          </div>
          <div class="analytics-item">
            <div class="analytics-value" id="published-count">-</div>
            <div class="analytics-label">Published</div>
          </div>
        </div>
        <div class="progress-bar-container">
          <div class="progress-label">
            <span>Grading Progress</span>
            <span id="grading-progress-text">0 / 0 graded</span>
          </div>
          <div class="progress" style="height: 12px;">
            <div class="progress-bar progress-bar-success" id="grading-bar" style="width: 0%;"></div>
          </div>
        </div>
      </div>
      
      <!-- Results Table -->
      <div class="results-table-container" id="results-section" style="display: none;">
        <div class="table-header">
          <h3 class="text-lg font-semibold">Student Results</h3>
          <input type="text" class="form-input" id="search-input" placeholder="Search student..." style="max-width: 250px;">
        </div>
        <table class="table">
          <thead>
            <tr>
              <th>Student</th>
              <th>Score</th>
              <th>Percentage</th>
              <th>Grading</th>
              <th>Status</th>
              <th>Submitted At</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="results-tbody">
            <tr><td colspan="7" class="text-center p-8 text-muted">Select an exam to view results</td></tr>
          </tbody>
        </table>
      </div>
      
      <div class="empty-state" id="empty-state">
        <div class="empty-state-icon">
          <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 20V10M12 20V4M6 20v-6"/>
          </svg>
        </div>
        <h3 class="empty-state-title">Select an Exam</h3>
        <p class="empty-state-description">Choose an exam from the dropdown above to grade and publish results.</p>
      </div>
    </div>
  </main>
  
  <!-- Grading Modal -->
  <div class="grading-overlay" id="grading-overlay" style="display: none;">
    <div class="grading-panel">
      <div class="grading-panel-header">
        <div>
          <h2 class="grading-panel-title" id="grading-student-name">Grade Student</h2>
          <p class="text-muted text-sm" id="grading-student-info"></p>
        </div>
        <button class="btn btn-ghost btn-sm" onclick="closeGradingPanel()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="grading-panel-summary" id="grading-panel-summary"></div>
      <div class="grading-panel-body" id="grading-answers-list">
        <!-- Answers will be rendered here -->
      </div>
      <div class="grading-panel-footer">
        <div class="grading-total" id="grading-total">Total: 0 / 0</div>
        <div class="flex gap-3">
          <button class="btn btn-ghost" onclick="closeGradingPanel()">Cancel</button>
          <button class="btn btn-primary" id="save-grades-btn" onclick="saveGrades()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
              <polyline points="17 21 17 13 7 13 7 21"/>
              <polyline points="7 3 7 8 15 8"/>
            </svg>
            Save All Grades
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <script src="../../js/config.js"></script>
  <script src="../../js/api.js"></script>
  <script src="../../js/auth.js"></script>
  <script src="../../js/utils.js"></script>
  <script src="../../js/staff-results.js"></script>
</body>
</html>
